// Script variables
var timelineConfig={key:"0Ahlne8dbHhEXdENXaUNlaTk3STU5VWxZMmt0T1U3dnc",sheetName:"Posts"};$(function(){function t(e,t){return t?Date.parse("January 1, "+e):Date.parse("December 31, "+e)+864e5-1}function n(n,r){var i=$("#post-template").html(),s=Handlebars.compile(i);i=$("#year-marker-template").html();var o=Handlebars.compile(i),u=[];$.each(r.sheets(timelineConfig.sheetName).all(),function(e,t){var n=(new Date(t.timestamp)).getFullYear();u.indexOf(n)<0&&(u[u.length]=n);var r=s(t);$("#timeline").append(r)});$.each(u,function(n,r){var i;e==="newest"?i=t(r,!1):i=t(r,!0);var s={year:r,timestamp:i},u=o(s);$("#timeline").append(u)});$("#timeline").imagesLoaded(function(){$("#timeline").isotope({itemSelector:".item",transformsEnabled:!0,layoutMode:"spineAlign",spineAlign:{gutterWidth:56},getSortData:{timestamp:function(e){return parseFloat(e.find(".timestamp").text())}},sortBy:"timestamp",sortAscending:!1,itemPositionDataEnabled:!0})})}function r(e){$(".year-marker").each(function(){var n=$(this),r=parseInt(n.find(".year").text(),10),i=t(r,e);n.find(".timestamp").text(i)})}function i(){var e=$(".item.last"),t=e.data("isotope-item-position"),n=e.find(".date").height(),r=e.find(".date").position(),i=parseInt(e.find(".inner").css("marginTop"),10),s=t.y+i+r.top+n/2;$("#line").height(s)}var e="newest";Tabletop.init({key:timelineConfig.key,callback:n,wanted:[timelineConfig.sheetName],postProcess:function(e){e.timestamp=Date.parse(e.date);e.display_date=e.displaydate;e.read_more_url=e.readmoreurl;e.photo_url=e.photourl}});$(".sort-buttons a").click(function(e){var t=$(this);if(t.hasClass("active"))return!1;$(".sort-buttons a").removeClass("active");t.addClass("active");var n=$(".year-markers");if(t.hasClass("sort-newest")){r(!1);$("#timeline").isotope("reloadItems").isotope({sortAscending:!1})}else{r(!0);$("#timeline").isotope("reloadItems").isotope({sortAscending:!0})}e.preventDefault()});$("#timeline").resize(function(){i()})});$.Isotope.prototype._spineAlignReset=function(){this.spineAlign={colA:0,colB:0,lastY:-60}};$.Isotope.prototype._spineAlignLayout=function(e){var t=this,n=this.spineAlign,r=Math.round(this.options.spineAlign&&this.options.spineAlign.gutterWidth)||0,i=Math.round(this.element.width()/2);e.each(function(s,o){var u=$(this);u.removeClass("last").removeClass("top");s===e.length-1&&u.addClass("last");var a,f;if(u.hasClass("year-marker")){var l=u.width();a=i-l/2;if(n.colA>=n.colB){f=n.colA;if(f===0){u.addClass("top");n.colA+=u.outerHeight(!0);n.colB=n.colA}}else{f=n.colB;if(f===0){u.addClass("top");n.colB+=u.outerHeight(!0);n.colA=n.colB}}}else{u.removeClass("left").removeClass("right");var c=n.colB>=n.colA;c?u.addClass("left"):u.addClass("right");a=c?i-(u.outerWidth(!0)+r/2):i+r/2;f=c?n.colA:n.colB;if(f-n.lastY<=60){var h=60-Math.abs(f-n.lastY);u.find(".inner").css("marginTop",h);n.lastY=f+h}else{u.find(".inner").css("marginTop",0);n.lastY=f}n[c?"colA":"colB"]+=u.outerHeight(!0)}t._pushPosition(u,a,f)})};$.Isotope.prototype._spineAlignGetContainerSize=function(){var e={};e.height=this.spineAlign[this.spineAlign.colB>this.spineAlign.colA?"colB":"colA"];return e};$.Isotope.prototype._spineAlignResizeChanged=function(){return!0};